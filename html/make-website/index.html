<!DOCTYPE html>
<html>
<head>
	<title>kzoo.tech</title>

	<style>
		:root {
			--palette1: #f2f3f0; /* white */
			--palette2: #8e8d80; /* olive */
			--palette3: #939aa0; /* grey */
			--palette4: #876759; /* brown */
			--palette5: #3a3336; /* black */
		}

		body {
			background-color: var(--palette5);
			color: var(--palette2);
			margin: 5em auto;
			max-width: 35em;
		}

		h1,h2,h3,h4,h5 {
			color: var(--palette4);
		}

		a {
			color: var(--palette3);
		}

		code {
			color: var(--palette1);
			background-color: rgba(0,0,0,.5);
			display: block;
			padding: 1em;
			overflow: hidden;
			font-size: small;
		}

		header {
			background-color: var(--palette5);
			position: fixed;
			top: 0;
			margin: 0 auto;
			width: 50em;
			padding: 1em 0;
			vertical-align: bottom;
			font-size: small;
			user-select: none;
		}

		footer {
			text-align: right;
			font-style: italic;
			font-size: small;
		}
	</style>
</head>
<body>
<header>
[<a href="https://kzoo.tech">kzoo.tech</a>]
 / [<a href='https://kzoo.tech/html'>html</a>]
 / [<a href='https://kzoo.tech/html/make-website'>make-website</a>]
 / [<a href='https://kzoo.tech/html/make-website/'></a>]

</header>
<h1>Building a Makefile-based Website</h1>

<p>This guide documents a <a href="https://man.openbsd.org/make">Makefile-based</a> website generator 
written to work with tools that are typically found on a "stock" BSD
installation. The generator parses <a href="https://daringfireball.net/projects/markdown">Markdown</a> files into HTML
pages, which can be served using any web server, such as OpenBSD's 
<a href="https://man.openbsd.org/make">httpd(8)</a>. This guide loosely based on John Hawthorn's 
<a href="https://johnhawthorn.com/2018/01/this-website-is-a-makefile/">This Website is a Makefile</a> article.</p>

<h2>template.pl</h2>

<p>The template file generates an HTML document from a valid Markdown file passed
in as the only command-line argument. This template can be modified to the needs
of a particular website. </p>

<p>This file makes use of <a href="https://metacpan.org/pod/Text::Markdown">Text::Markdown</a> to convert Markdown files
into HTML documents. Note that the Makefile adds perl5lib/ as an additional 
directory when searching for modules and Text/Markdown.pl can be installed
locally to this location.</p>

<p>This file contains some additional methods for adding
breadcrumbs and a date stamp to each HTML document rendered.</p>

<h1>!/usr/bin/perl</h1>

<h1>file: bin/render.pl</h1>

<h1>auth: Andrew Alm <a href="&#x6D;&#x61;&#105;&#108;&#116;&#111;:c&#111;&#x6E;&#116;&#x61;&#x63;t&#64;&#x6B;&#122;&#111;&#111;&#x2E;&#x74;e&#x63;&#104;">c&#111;&#x6E;&#116;&#x61;&#x63;t&#64;&#x6B;&#122;&#111;&#111;&#x2E;&#x74;e&#x63;&#104;</a></h1>

<h1>desc: HTML rendering scripts for kzoo.tech websites which converts markdown</h1>

<h1>files into stand-alone HTML documents.</h1>

<p>use 5.10.0;
use strict;
use warnings;</p>

<h1>modules</h1>

<p>use File::Spec;
use POSIX;
use Text::Markdown;</p>

<p>sub breadcrumbs { # navigational breadcrumbs
  my ($vol, $dirs, $file) = File::Spec->splitpath(@_);
  my $url = "https://kzoo.tech";
  my $html = "[<a href=\"$url\">kzoo.tech</a>]\n";</p>

<pre><code>foreach my $dir (File::Spec-&gt;splitdir($dirs)) {
  $url  .= "/$dir";
  $html .= " / [&lt;a href='$url'&gt;$dir&lt;/a&gt;]\n";
}

$file =~ s/\.md//;
if ("index" ne $file) {
  $html .= " / [&lt;a href='$url/$file'&gt;$file&lt;/a&gt;]\n";
}

return $html;
</code></pre>

<p>}</p>

<p>sub datestamp { # modify time of file
  my $date = POSIX::strftime("%Y %b %d", localtime((stat($_[0]))[9]));
  return "Last Modified: $date";
}</p>

<p>sub markdown { # generate html from md
  my $md = Text::Markdown->new(empty_element_suffix => '>', tab_width => 2); 
  return $md->markdown($_[0]);
}</p>

<h1>render html</h1>

<p>if (0 != $#ARGV) { # 1 argument only
  die "usage: render.pl [file]";
}</p>

<p>open my $fh, "&lt;", $ARGV[0] or die "cannot read file";
my $header  = breadcrumbs($ARGV[0]);
my $content = markdown(do { local $/; <$fh> });
my $footer  = datestamp($ARGV[0]);</p>

<p>print &lt;<EOF;
<!DOCTYPE html>
<html>
<head>
  <title>kzoo.tech</title></p>

<pre><code>&lt;style&gt;
  :root {
    --palette1: #f2f3f0; /* white */
    --palette2: #8e8d80; /* olive */
    --palette3: #939aa0; /* grey */
    --palette4: #876759; /* brown */
    --palette5: #3a3336; /* black */
  }

  body {
    background-color: var(--palette5);
    color: var(--palette2);
    margin: 5em auto;
    max-width: 35em;
  }

  h1,h2,h3,h4,h5 {
    color: var(--palette4);
  }

  a {
    color: var(--palette3);
  }

  code {
    color: var(--palette1);
    background-color: rgba(0,0,0,.5);
    display: block;
    padding: 1em;
    overflow: hidden;
    font-size: small;
  }

  header {
    background-color: var(--palette5);
    position: fixed;
    top: 0;
    margin: 0 auto;
    width: 50em;
    padding: 1em 0;
    vertical-align: bottom;
    font-size: small;
    user-select: none;
  }

  footer {
    text-align: right;
    font-style: italic;
    font-size: small;
  }
&lt;/style&gt;
</code></pre>

<p></head>
<body>
<header>
$header
</header>
$content
<footer>
$footer
</footer>
</body>
</html>
EOF</p>

<h2>Makefile.site</h2>

<h2>Makefile</h2>

<pre><code>prompt# cat template.pl
.PHONY: all clean preview publish
.DEFAULT: all

.include "Makefile.site"

# commands
SRC   != find . -type f -name "*.md" ! -name "index.md" | sed "s/\.\///g"
PERL  := PERL5LIB=perl5lib/ perl
RSYNC := openrsync --rsync-path=openrsync

# render html
all: $(SRC:%.md=html/%/index.html) html/index.html

html/index.html: index.md template.pl
  $(PERL) template.pl index.md &gt; html/index.html

.for page in $(SRC:%.md=%)
html/$(page)/index.html: $(page).md template.pl
  mkdir -p html/$(page)
  $(PERL) template.pl $(page).md &gt; html/$(page)/index.html
.endfor

# publish/preview using rsync; requires user-interaction
preview:
  $(RSYNC) -r --del html/ $(PREVIEW-DIR)/

publish:
  $(RSYNC) -r --del html/ $(RELEASE-DIR)/

# remove build files
clean:
  rm -rf html/index.html
  for dir in $(SRC:%.md='%'); do \
    rm -rf html/$${dir};         \
  done
</code></pre>

<h2>Downloads</h2>

<footer>
Last Modified: 2020 Aug 20
</footer>
</body>
</html>
